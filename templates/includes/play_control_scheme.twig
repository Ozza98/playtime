<div id="modal-control-scheme" class="modal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-fullscreen-lg-down">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Controls</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div id="play-virtual-gamepad-control" class="text-center">
                    <button type="button" id="play-virtual-gamepad-toggle" class="btn btn-outline-secondary">Toggle virtual gamepad</button>
                    <hr>
                </div>

                <ul class="nav nav-underline mb-3" id="control-scheme-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active"
                                id="scheme-player-0-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#scheme-player-0"
                                type="button"
                                role="tab"
                                aria-controls="scheme-player-0"
                                aria-selected="true"
                        >Player 1</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link"
                                id="keyboard-player-1-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#scheme-player-1"
                                type="button"
                                role="tab"
                                aria-controls="scheme-player-1"
                                aria-selected="false"
                        >Player 2</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link"
                                id="scheme-player-2-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#scheme-player-2"
                                type="button"
                                role="tab"
                                aria-controls="scheme-player-2"
                                aria-selected="false"
                        >Player 3</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link"
                                id="scheme-player-3-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#scheme-player-3"
                                type="button"
                                role="tab"
                                aria-controls="scheme-player-3"
                                aria-selected="false"
                        >Player 4</button>
                    </li>
                </ul>
                <div class="tab-content" id="control-scheme">
                    <div class="tab-pane active" id="scheme-player-0" role="tabpanel" aria-labelledby="scheme-player-0-tab" tabindex="0">
                        {% include "platform_settings/controls_by_platform.twig" with platform_id=game.Platform player="0" controls=emulator_settings.Controls[0] %}
                    </div>
                    <div class="tab-pane" id="scheme-player-1" role="tabpanel" aria-labelledby="scheme-player-1-tab" tabindex="1">
                        {% include "platform_settings/controls_by_platform.twig" with platform_id=game.Platform player="1" controls=emulator_settings.Controls[1] %}
                    </div>
                    <div class="tab-pane" id="scheme-player-2" role="tabpanel" aria-labelledby="scheme-player-2-tab" tabindex="2">
                        {% include "platform_settings/controls_by_platform.twig" with platform_id=game.Platform player="2" controls=emulator_settings.Controls[2] %}
                    </div>
                    <div class="tab-pane" id="scheme-player-3" role="tabpanel" aria-labelledby="scheme-player-3-tab" tabindex="3">
                        {% include "platform_settings/controls_by_platform.twig" with platform_id=game.Platform player="3" controls=emulator_settings.Controls[3] %}
                    </div>
                </div>
            </div>
            <div class="modal-footer text-end">
                <button type="button" id="play-control-scheme-reset" class="btn btn-outline-secondary">Reset changes</button>
                <button type="button" id="play-control-scheme-save" class="btn btn-primary" data-bs-dismiss="modal">Save</button>
            </div>
        </div>
    </div>
</div>

{% include "form_platform_settings_controls_modals.twig" %}
<script src="/assets/platform-settings-controls.js"></script>

<script>
    EJS_defaultControls = {
        {% for controls in emulator_settings.Controls %}
        "{{ forloop.Counter0 }}": {
            0: {
                value: "{{ controls.Keyboard.B }}",
                value2: "{{ controls.Gamepad.B }}"
            },
            1: {
                value: "{{ controls.Keyboard.Y }}",
                value2: "{{ controls.Gamepad.Y }}"
            },
            2: {
                value: "{{ controls.Keyboard.Select }}",
                value2: "{{ controls.Gamepad.Select }}"
            },
            3: {
                value: "{{ controls.Keyboard.Start }}",
                value2: "{{ controls.Gamepad.Start }}"
            },
            4: {
                value: "{{ controls.Keyboard.Up }}",
                value2: "{{ controls.Gamepad.Up }}"
            },
            5: {
                value: "{{ controls.Keyboard.Down }}",
                value2: "{{ controls.Gamepad.Down }}"
            },
            6: {
                value: "{{ controls.Keyboard.Left }}",
                value2: "{{ controls.Gamepad.Left }}"
            },
            7: {
                value: "{{ controls.Keyboard.Right }}",
                value2: "{{ controls.Gamepad.Right }}"
            },
            8: {
                value: "{{ controls.Keyboard.A }}",
                value2: "{{ controls.Gamepad.A }}"
            },
            9: {
                value: "{{ controls.Keyboard.X }}",
                value2: "{{ controls.Gamepad.X }}"
            },
            10: {
                value: "{{ controls.Keyboard.L }}",
                value2: "{{ controls.Gamepad.L }}"
            },
            11: {
                value: "{{ controls.Keyboard.R }}",
                value2: "{{ controls.Gamepad.R }}"
            },
            12: {
                value: "{{ controls.Keyboard.L2 }}",
                value2: "{{ controls.Gamepad.L2 }}"
            },
            13: {
                value: "{{ controls.Keyboard.R2 }}",
                value2: "{{ controls.Gamepad.R2 }}"
            },
            14: {
                value: "{{ controls.Keyboard.L3 }}",
                value2: "{{ controls.Gamepad.L3 }}"
            },
            15: {
                value: "{{ controls.Keyboard.R3 }}",
                value2: "{{ controls.Gamepad.R3 }}"
            },
            16: {
                value: "{{ controls.Keyboard.LStickRight }}",
                value2: "{{ controls.Gamepad.LStickRight }}"
            },
            17: {
                value: "{{ controls.Keyboard.LStickLeft }}",
                value2: "{{ controls.Gamepad.LStickLeft }}"
            },
            18: {
                value: "{{ controls.Keyboard.LStickDown }}",
                value2: "{{ controls.Gamepad.LStickDown }}"
            },
            19: {
                value: "{{ controls.Keyboard.LStickUp }}",
                value2: "{{ controls.Gamepad.LStickUp }}"
            },
            20: {
                value: "{{ controls.Keyboard.RStickRight }}",
                value2: "{{ controls.Gamepad.RStickRight }}"
            },
            21: {
                value: "{{ controls.Keyboard.RStickLeft }}",
                value2: "{{ controls.Gamepad.RStickLeft }}"
            },
            22: {
                value: "{{ controls.Keyboard.RStickDown }}",
                value2: "{{ controls.Gamepad.RStickDown }}"
            },
            23: {
                value: "{{ controls.Keyboard.RStickUp }}",
                value2: "{{ controls.Gamepad.RStickUp }}"
            },
            24: {},
            25: {},
            26: {},
            27: {
                value: "{{ controls.Keyboard.FastForward }}",
                value2: "{{ controls.Gamepad.FastForward }}"
            },
            28: {
                value: "{{ controls.Keyboard.Rewind }}",
                value2: "{{ controls.Gamepad.Rewind }}",
            },
            29: {
                value: "{{ controls.Keyboard.SlowMotion }}",
                value2: "{{ controls.Gamepad.SlowMotion }}",
            },
        },
        {% endfor %}
    };

    window.PlaytimeControls = {
        {% for controls in emulator_settings.Controls %}
        "{{ forloop.Counter0 }}": {
            save: {
                value: "{{ controls.Keyboard.QuickSaveState }}",
                value2: "{{ controls.Gamepad.QuickSaveState }}",
            },
            load: {
                value: "{{ controls.Keyboard.QuickLoadState }}",
                value2: "{{ controls.Gamepad.QuickLoadState }}",
            },
        },
        {% endfor %}
    };

</script>
